<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Integrate NLP with Technical Indicators, Yang&#39;s Blog">
    <meta name="description" content="CS Student / NLP Enthusiast / Tireless Coder">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Integrate NLP with Technical Indicators | Yang&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/Yang-Tech-Blog/favicon.png">

    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/css/my.css">
    
    <script src="/Yang-Tech-Blog/libs/jquery/jquery.min.js"></script>

    <script src='http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default'>
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true,
                processEnvironments: true,
            }
        });
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
    <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js">
    </script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head>




<body>
    
        <!--  加载动画，强制加载0.5s  -->
        <style type="text/css">
    #loading-container{
    position: fixed;
    top: 0;
    left: 0;
    min-height: 100vh;
    width: 100vw;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #FFF;
    text-align: center;
    /* loader页面消失采用渐隐的方式*/
    -webkit-transition: opacity 1s ease;
    -moz-transition: opacity 1s ease;
    -o-transition: opacity 1s ease;
    transition: opacity 1s ease;
}
.loading-image{
    width: 120px;
    height: 50px;
    transform: translate(-50%);
}

.loading-image div:nth-child(2) {
    -webkit-animation: pacman-balls 1s linear 0s infinite;
    animation: pacman-balls 1s linear 0s infinite
}

.loading-image div:nth-child(3) {
    -webkit-animation: pacman-balls 1s linear .33s infinite;
    animation: pacman-balls 1s linear .33s infinite
}

.loading-image div:nth-child(4) {
    -webkit-animation: pacman-balls 1s linear .66s infinite;
    animation: pacman-balls 1s linear .66s infinite
}

.loading-image div:nth-child(5) {
    -webkit-animation: pacman-balls 1s linear .99s infinite;
    animation: pacman-balls 1s linear .99s infinite
}

.loading-image div:first-of-type {
    width: 0;
    height: 0;
    border: 25px solid #49b1f5;
    border-right-color: transparent;
    border-radius: 25px;
    -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
    animation: rotate_pacman_half_up .5s 0s infinite;
}
.loading-image div:nth-child(2) {
    width: 0;
    height: 0;
    border: 25px solid #49b1f5;
    border-right-color: transparent;
    border-radius: 25px;
    -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
    animation: rotate_pacman_half_down .5s 0s infinite;
    margin-top: -50px;
}
@-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

@keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

@-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

@keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

@-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

@keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}


.loading-image div:nth-child(3),
.loading-image div:nth-child(4),
.loading-image div:nth-child(5),
.loading-image div:nth-child(6){
    background-color: #49b1f5;
    width: 15px;
    height: 15px;
    border-radius: 100%;
    margin: 2px;
    width: 10px;
    height: 10px;
    position: absolute;
    transform: translateY(-6.25px);
    top: 25px;
    left: 100px;
}
.loading-text{
    margin-bottom: 20vh;
    text-align: center;
    color: #2c3e50;
    font-size: 2rem;
    box-sizing: border-box;
    padding: 0 10px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
@media only screen and (max-width: 500px) {
    .loading-text{
        font-size: 1.5rem;
    }
}
.fadeout {
    opacity: 0;
    filter: alpha(opacity=0);
}
/* logo出现动画 */
@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
</style>
<div id="loading-container">
    <p class="loading-text">Stealing pages from the server... </p>
    <div class="loading-image">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
<script>
    (function () {
        const loaded = function () {
            setTimeout(function () {
                const loader = document.getElementById("loading-container");
                loader.className = "fadeout";
                setTimeout(function () {
                    loader.style.display = "none";
                }, 500);
            }, 500);
        };
        loaded();
    })();
</script>
    
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/Yang-Tech-Blog/" class="waves-effect waves-light">
                    
                    <img src="/Yang-Tech-Blog/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Yang&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/Yang-Tech-Blog/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/Yang-Tech-Blog/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Yang&#39;s Blog</div>
        <div class="logo-desc">
            
            CS Student / NLP Enthusiast / Tireless Coder
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/Yang-Tech-Blog/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/penguinwang96825" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/penguinwang96825" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/Yang-Tech-Blog/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('Please enter the password to access this article!')).toString(CryptoJS.enc.Hex)) {
                alert('Wrong password, will return to the home page!');
                location.href = '/Yang-Tech-Blog/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://github.com/penguinwang96825/penguinwang96825.github.io/blob/master/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/wallhaven-4yqqqx.jpg?raw=true')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Integrate NLP with Technical Indicators</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/Yang-Tech-Blog/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/Yang-Tech-Blog/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                            <a href="/Yang-Tech-Blog/tags/NLP/">
                                <span class="chip bg-color">NLP</span>
                            </a>
                        
                            <a href="/Yang-Tech-Blog/tags/Trading/">
                                <span class="chip bg-color">Trading</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/Yang-Tech-Blog/categories/Finance/" class="post-category">
                                Finance
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-06-10
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    6.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    40 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/Yang-Tech-Blog/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The aim of this project is to build a model which can make informed buy-and-sell decisions with respect to cryptocurrency trading. The model will do so by leveraging streaming news-feed data (Twitter, Bloomberg, etc.) as well as pricing data (open, close, etc.) to inform its predictions.</p>
<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><p>Hyperparameters for neural networks.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DictObj</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">import</span> pprint
        self<span class="token punctuation">.</span><span class="token builtin">map</span> <span class="token operator">=</span> mp
        pprint<span class="token punctuation">.</span>pprint<span class="token punctuation">(</span>mp<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'map'</span><span class="token punctuation">:</span>
            <span class="token builtin">object</span><span class="token punctuation">.</span>__setattr__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        self<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>  self<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>


Config <span class="token operator">=</span> DictObj<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string">"LABEL_GENERATION"</span><span class="token punctuation">:</span> <span class="token string">"tb"</span><span class="token punctuation">,</span> 
    <span class="token string">"LAGGING"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
    <span class="token string">"MAX_LENGTH"</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> 
    <span class="token string">"TRAIN_BATCH_SIZE"</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> 
    <span class="token string">"VALID_BATCH_SIZE"</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> 
    <span class="token string">"TEST_BATCH_SIZE"</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> 
    <span class="token string">"MAX_EPOCHS"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> 
    <span class="token string">"EMBEDDING_SIZE"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> 
    <span class="token string">"NUM_CLASSES"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
    <span class="token string">"NUM_KERNELS"</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">,</span> 
    <span class="token string">"DROPOUT_RATE"</span><span class="token punctuation">:</span> <span class="token number">0.1</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="Load-Data"><a href="#Load-Data" class="headerlink" title="Load Data"></a>Load Data</h1><p>The news is sourced from Bloomberg and spans the years 2014-09-23 to 2020-12-10. The row with the words “bitcoin,” “blockchain,” and “crypto” will be preserved. In terms of auto labelling, I used the Triple Barrier Method in this project because it provides the greatest results.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">text_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">r"C:\Users\Yang\Desktop\Dissertation\data\processed\news\bloomberg\BloombergV2.csv"</span><span class="token punctuation">)</span>
text_df <span class="token operator">=</span> text_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"date"</span><span class="token punctuation">,</span> <span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
text_df<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"date"</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">]</span>
preprocess_func <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
text_pipeline <span class="token operator">=</span> TextPipeline<span class="token punctuation">(</span>text_df<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"bitcoin"</span><span class="token punctuation">,</span> <span class="token string">"blockchain"</span><span class="token punctuation">,</span> <span class="token string">"crypto"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> preprocess_func<span class="token punctuation">)</span>
text_processed_df <span class="token operator">=</span> text_pipeline<span class="token punctuation">.</span>get_dataframe<span class="token punctuation">(</span><span class="token punctuation">)</span>

price_df <span class="token operator">=</span> yf<span class="token punctuation">.</span>download<span class="token punctuation">(</span><span class="token string">"BTC-USD"</span><span class="token punctuation">,</span> progress<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
price_pipeline <span class="token operator">=</span> PricePipeline<span class="token punctuation">(</span>price_df<span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token string">"close"</span><span class="token punctuation">,</span> label<span class="token operator">=</span>Config<span class="token punctuation">.</span>LABEL_GENERATION<span class="token punctuation">)</span>
price_processed_df <span class="token operator">=</span> price_pipeline<span class="token punctuation">.</span>get_dataframe<span class="token punctuation">(</span><span class="token punctuation">)</span>

text_price_pipeline <span class="token operator">=</span> TextPricePipeline<span class="token punctuation">(</span>text_processed_df<span class="token punctuation">,</span> price_processed_df<span class="token punctuation">,</span> lagging<span class="token operator">=</span>Config<span class="token punctuation">.</span>LAGGING<span class="token punctuation">)</span>
text_price_df <span class="token operator">=</span> text_price_pipeline<span class="token punctuation">.</span>get_dataframe<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Text-Preprocessing"><a href="#Text-Preprocessing" class="headerlink" title="Text Preprocessing"></a>Text Preprocessing</h2><p>Text processing is an automated method of evaluating and categorising unstructured text input in order to extract useful information.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">clean_text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    REPLACE_BY_SPACE_RE <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[/()&#123;&#125;\[\]\|@,;]'</span><span class="token punctuation">)</span>
    BAD_SYMBOLS_RE <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[^0-9a-z #+_]'</span><span class="token punctuation">)</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    text <span class="token operator">=</span> REPLACE_BY_SPACE_RE<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>
    text <span class="token operator">=</span> BAD_SYMBOLS_RE<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> text

text_price_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span> <span class="token operator">=</span> text_price_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
text_price_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span> <span class="token operator">=</span> text_price_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>clean_text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Tokenisation-for-Train-Validation-Test-Sets"><a href="#Tokenisation-for-Train-Validation-Test-Sets" class="headerlink" title="Tokenisation for Train/Validation/Test Sets"></a>Tokenisation for Train/Validation/Test Sets</h2><p>Tokenisation is the process of breaking down a phrase, sentence, paragraph, or even an entire text document into smaller components like individual words or phrases.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"bert-base-uncased"</span><span class="token punctuation">)</span>

train_df <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token string">"2016-12-31"</span><span class="token punctuation">]</span>
valid_df <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2017-01-01"</span><span class="token punctuation">:</span><span class="token string">"2017-12-31"</span><span class="token punctuation">]</span>
test_df <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2018-01-01"</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

input_ids <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>batch_encode_plus<span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                        padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        max_length<span class="token operator">=</span>Config<span class="token punctuation">.</span>MAX_LENGTH<span class="token punctuation">,</span> 
                                        add_special_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> 
                                        return_token_type_ids<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                                        return_attention_mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
X_train <span class="token operator">=</span> input_ids<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> train_df<span class="token punctuation">.</span>label

input_ids <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>batch_encode_plus<span class="token punctuation">(</span>valid_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                        padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        max_length<span class="token operator">=</span>Config<span class="token punctuation">.</span>MAX_LENGTH<span class="token punctuation">,</span> 
                                        add_special_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> 
                                        return_token_type_ids<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                                        return_attention_mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
X_valid <span class="token operator">=</span> input_ids<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
y_valid <span class="token operator">=</span> valid_df<span class="token punctuation">.</span>label

input_ids <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>batch_encode_plus<span class="token punctuation">(</span>test_df<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                        padding<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        truncation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        max_length<span class="token operator">=</span>Config<span class="token punctuation">.</span>MAX_LENGTH<span class="token punctuation">,</span> 
                                        add_special_tokens<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
                                        return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">,</span> 
                                        return_token_type_ids<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                                        return_attention_mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
X_test <span class="token operator">=</span> input_ids<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
y_test <span class="token operator">=</span> test_df<span class="token punctuation">.</span>label<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Construct-Dataset-and-Dataloader"><a href="#Construct-Dataset-and-Dataloader" class="headerlink" title="Construct Dataset and Dataloader"></a>Construct Dataset and Dataloader</h2><p>Dataset that allow you to use pre-loaded datasets as well as your own data. Dataset stores the samples and their corresponding labels, and DataLoader wraps an iterable around the Dataset to enable easy access to the samples.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TextDataset</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_ids<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>X <span class="token operator">=</span> input_ids
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> labels

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"&lt;Dataset(N=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)>"</span></span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        X <span class="token operator">=</span> self<span class="token punctuation">.</span>X<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        y <span class="token operator">=</span> self<span class="token punctuation">.</span>y<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>X<span class="token punctuation">,</span> y<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">create_dataloader</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>
            dataset<span class="token operator">=</span>self<span class="token punctuation">,</span>
            batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
            shuffle<span class="token operator">=</span>shuffle<span class="token punctuation">,</span>
            drop_last<span class="token operator">=</span>drop_last<span class="token punctuation">,</span>
            pin_memory<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
            num_workers<span class="token operator">=</span>num_workers<span class="token punctuation">)</span>

train_dataset <span class="token operator">=</span> TextDataset<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
valid_dataset <span class="token operator">=</span> TextDataset<span class="token punctuation">(</span>X_valid<span class="token punctuation">,</span> y_valid<span class="token punctuation">)</span>
test_dataset <span class="token operator">=</span> TextDataset<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>

train_dataloader <span class="token operator">=</span> train_dataset<span class="token punctuation">.</span>create_dataloader<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>Config<span class="token punctuation">.</span>TRAIN_BATCH_SIZE<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
valid_dataloader <span class="token operator">=</span> valid_dataset<span class="token punctuation">.</span>create_dataloader<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>Config<span class="token punctuation">.</span>VALID_BATCH_SIZE<span class="token punctuation">)</span>
test_dataloader <span class="token operator">=</span> test_dataset<span class="token punctuation">.</span>create_dataloader<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>Config<span class="token punctuation">.</span>TEST_BATCH_SIZE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="Modelling"><a href="#Modelling" class="headerlink" title="Modelling"></a>Modelling</h1><p>Building representations of things in the ‘real world’ and allowing concepts to be probed is what modelling is all about.</p>
<h2 id="Pytorch-Lightning-Module"><a href="#Pytorch-Lightning-Module" class="headerlink" title="Pytorch Lightning Module"></a>Pytorch Lightning Module</h2><p>Pytorch Lightning structures PyTorch code so it can abstract the details of training.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">LightningMultiClassModule</span><span class="token punctuation">(</span>pl<span class="token punctuation">.</span>LightningModule<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Multi-class Classification Engine
    """</span>
    
    learning_rate <span class="token operator">=</span> <span class="token number">1e-3</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>train_losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>valid_losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>train_accuracies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>valid_accuracies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError
    
    <span class="token keyword">def</span> <span class="token function">configure_optimizers</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>self<span class="token punctuation">.</span>learning_rate<span class="token punctuation">)</span>
        <span class="token keyword">return</span> optimizer
    
    <span class="token keyword">def</span> <span class="token function">training_step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch<span class="token punctuation">,</span> batch_idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        batch<span class="token punctuation">,</span> y <span class="token operator">=</span> batch
        y_hat <span class="token operator">=</span> self<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
        labels_hat <span class="token operator">=</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        n_correct_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y <span class="token operator">==</span> labels_hat<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"train_loss"</span><span class="token punctuation">,</span> loss<span class="token punctuation">,</span> on_step<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> on_epoch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'loss'</span><span class="token punctuation">:</span> loss<span class="token punctuation">,</span> <span class="token string">"n_correct_pred"</span><span class="token punctuation">:</span> n_correct_pred<span class="token punctuation">,</span> <span class="token string">"n_pred"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">def</span> <span class="token function">training_epoch_end</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> outputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        avg_loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'loss'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
        train_acc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'n_correct_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'n_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>train_losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>avg_loss<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>train_accuracies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_acc<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">validation_step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch<span class="token punctuation">,</span> batch_idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        batch<span class="token punctuation">,</span> y <span class="token operator">=</span> batch
        y_hat <span class="token operator">=</span> self<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        labels_hat <span class="token operator">=</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        n_correct_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y <span class="token operator">==</span> labels_hat<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string">"valid_loss"</span><span class="token punctuation">,</span> loss<span class="token punctuation">,</span> on_step<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> on_epoch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'val_loss'</span><span class="token punctuation">:</span> loss<span class="token punctuation">,</span> <span class="token string">"n_correct_pred"</span><span class="token punctuation">:</span> n_correct_pred<span class="token punctuation">,</span> <span class="token string">"n_pred"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">def</span> <span class="token function">validation_epoch_end</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> outputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        avg_loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'val_loss'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
        val_acc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'n_correct_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'n_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>valid_losses<span class="token punctuation">.</span>append<span class="token punctuation">(</span>avg_loss<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>valid_accuracies<span class="token punctuation">.</span>append<span class="token punctuation">(</span>val_acc<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_step</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch<span class="token punctuation">,</span> batch_idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        batch<span class="token punctuation">,</span> y <span class="token operator">=</span> batch
        y_hat <span class="token operator">=</span> self<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        labels_hat <span class="token operator">=</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        n_correct_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>y <span class="token operator">==</span> labels_hat<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'test_loss'</span><span class="token punctuation">:</span> loss<span class="token punctuation">,</span> <span class="token string">"n_correct_pred"</span><span class="token punctuation">:</span> n_correct_pred<span class="token punctuation">,</span> <span class="token string">"n_pred"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">def</span> <span class="token function">test_epoch_end</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> outputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        avg_loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'test_loss'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
        test_acc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token string">'n_correct_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token string">'n_pred'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> outputs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">predict_proba</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> test_dataloader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Prediction Step"""</span>
        <span class="token comment"># Set model to eval mode</span>
        self<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        y_probs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># Iterate over val batches</span>
        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> batch <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>tqdm<span class="token punctuation">(</span>test_dataloader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> batch
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
                <span class="token comment"># Forward pass with inputs</span>
                y_prob <span class="token operator">=</span> self<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                <span class="token comment"># Store outputs</span>
                y_probs<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>y_prob<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                
        <span class="token keyword">return</span> softmax<span class="token punctuation">(</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>y_probs<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h2><p>The convolutional neural network for text, or TextCNN, is a helpful deep learning technique for tasks including sentiment analysis and question classification.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TextCNN</span><span class="token punctuation">(</span>LightningMultiClassModule<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    https://finisky.github.io/2020/07/03/textcnnmvp/
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> embed_num<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> class_num<span class="token punctuation">,</span> kernel_num<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> kernel_sizes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TextCNN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        Ci <span class="token operator">=</span> <span class="token number">1</span>
        Co <span class="token operator">=</span> kernel_num

        self<span class="token punctuation">.</span>embed <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>embed_num<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>convs <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>Ci<span class="token punctuation">,</span> Co<span class="token punctuation">,</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> kernel_sizes<span class="token punctuation">]</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>Co <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>kernel_sizes<span class="token punctuation">)</span><span class="token punctuation">,</span> class_num<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>embed<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                                         <span class="token comment"># (N, token_num, embed_dim)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                        <span class="token comment"># (N, Ci, token_num, embed_dim)</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>conv<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">for</span> conv <span class="token keyword">in</span> self<span class="token punctuation">.</span>convs<span class="token punctuation">]</span>   <span class="token comment"># [(N, Co, token_num) * len(kernel_sizes)]</span>
        x <span class="token operator">=</span> <span class="token punctuation">[</span>F<span class="token punctuation">.</span>max_pool1d<span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span>    <span class="token comment"># [(N, Co) * len(kernel_sizes)]</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>                                       <span class="token comment"># (N, Co * len(kernel_sizes))</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                                       <span class="token comment"># (N, Co * len(kernel_sizes))</span>
        logit <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                                        <span class="token comment"># (N, class_num)</span>
        <span class="token keyword">return</span> logit
    
    <span class="token keyword">def</span> <span class="token function">configure_optimizers</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        optimiser <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>self<span class="token punctuation">.</span>learning_rate<span class="token punctuation">)</span>
        <span class="token comment"># scheduler = torch.optim.lr_scheduler.StepLR(optimizer, step_size=1, gamma=0.1)</span>
        <span class="token comment"># return [optimizer], [scheduler]</span>
        <span class="token keyword">return</span> optimiser
    
<span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">:</span>
        torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>xavier_uniform<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
        m<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fill_<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Start-Training-Process"><a href="#Start-Training-Process" class="headerlink" title="Start Training Process"></a>Start Training Process</h3><p>The process of training an ML model entails sending training data to an ML algorithm (that is, the learning algorithm).</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">textcnn <span class="token operator">=</span> TextCNN<span class="token punctuation">(</span>embed_num<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>tokenizer<span class="token punctuation">.</span>vocab<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                  embed_dim<span class="token operator">=</span>Config<span class="token punctuation">.</span>EMBEDDING_SIZE<span class="token punctuation">,</span> 
                  class_num<span class="token operator">=</span>Config<span class="token punctuation">.</span>NUM_CLASSES<span class="token punctuation">,</span> 
                  kernel_num<span class="token operator">=</span>Config<span class="token punctuation">.</span>NUM_KERNELS<span class="token punctuation">,</span> 
                  kernel_sizes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                  dropout<span class="token operator">=</span>Config<span class="token punctuation">.</span>DROPOUT_RATE<span class="token punctuation">)</span>
textcnn<span class="token punctuation">.</span>learning_rate <span class="token operator">=</span> <span class="token number">3e-5</span>
textcnn<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span>
trainer <span class="token operator">=</span> pl<span class="token punctuation">.</span>Trainer<span class="token punctuation">(</span>gpus<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> precision<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fast_dev_run<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> num_sanity_val_steps<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>textcnn<span class="token punctuation">,</span> train_dataloader<span class="token punctuation">,</span> valid_dataloader<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p>After training 20 epochs, we can get f1 score of 48.7999% and accuracy of 56.2021%.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">test_probs <span class="token operator">=</span> textcnn<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>test_dataloader<span class="token punctuation">)</span>
test_preds <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>test_probs<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
metrics<span class="token punctuation">.</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_preds<span class="token punctuation">,</span> average<span class="token operator">=</span><span class="token string">"weighted"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_preds<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Accuracy curve is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/textcnn-acc.png" class="">

<p>Loss curve is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/textcnn-loss.png" class="">

<p>Confusion matrix is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/textcnn-cm.png" class="">

<h3 id="Backtest"><a href="#Backtest" class="headerlink" title="Backtest"></a>Backtest</h3><p>Backtesting is a way for determining how well a strategy or model would have performed in the absence of the strategy or model. Backtesting is a method of determining the viability of a trading strategy by examining how it would perform in the real world using previous data. If backtesting proves to be effective, traders and analysts may be more willing to use it in the future.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">trends <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>test_probs<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
entries<span class="token punctuation">,</span> exits <span class="token operator">=</span> trend_to_signal<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>trends<span class="token punctuation">)</span><span class="token punctuation">)</span>

price_test <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
mlbp_textcnn <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                                entries<span class="token punctuation">,</span> 
                                                exits<span class="token punctuation">,</span> 
                                                show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_textcnn<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/nlp1.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/nlp2.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                           2018-01-01 00:00:00
End                             2020-12-10 00:00:00
Duration                          653 days 00:00:00
Init. Cash                                   1000.0
Total Profit                            -271.728922
Total Return [%]                         -27.172892
Benchmark Return [%]                      31.469924
Position Coverage [%]                     12.404288
Max. Drawdown [%]                         52.866542
Avg. Drawdown [%]                         26.433271
Max. Drawdown Duration            636 days 00:00:00
Avg. Drawdown Duration            319 days 00:00:00
Num. Trades                                      70
Win Rate [%]                              51.428571
Best Trade [%]                            18.039317
Worst Trade [%]                          -14.736523
Avg. Trade [%]                            -0.335031
Max. Trade Duration                 3 days 00:00:00
Avg. Trade Duration       1 days 03:46:17.142857142
Expectancy                                -3.881842
SQN                                        -0.96268
Gross Exposure                             0.124043
Sharpe Ratio                              -0.418759
Sortino Ratio                             -0.581125
Calmar Ratio                              -0.307222<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h2><p>Google created a Transformer-based machine learning methodology for natural language processing pre-training called Bidirectional Encoder Representations from Transformers. Jacob Devlin and his Google colleagues designed and published BERT in 2018.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> BertModel<span class="token punctuation">,</span> AdamW

<span class="token keyword">class</span> <span class="token class-name">BERTBaseUncased</span><span class="token punctuation">(</span>LightningMultiClassModule<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_classes<span class="token punctuation">,</span> learning_rate<span class="token operator">=</span><span class="token number">3e-5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>BERTBaseUncased<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>learning_rate <span class="token operator">=</span> learning_rate
        self<span class="token punctuation">.</span>bert <span class="token operator">=</span> BertModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"bert-base-uncased"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>classifier <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        b_o <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>pooler_output<span class="token punctuation">)</span>
        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>classifier<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn<span class="token punctuation">(</span>b_o<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> logits
    
    <span class="token keyword">def</span> <span class="token function">freeze_bert_encoder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> param <span class="token keyword">in</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            param<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">unfreeze_bert_encoder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> param <span class="token keyword">in</span> self<span class="token punctuation">.</span>bert<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            param<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">True</span>
            
    <span class="token keyword">def</span> <span class="token function">configure_optimizers</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        optimizer <span class="token operator">=</span> AdamW<span class="token punctuation">(</span>self<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>self<span class="token punctuation">.</span>learning_rate<span class="token punctuation">)</span>
        <span class="token keyword">return</span> optimizer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Start-Training-Process-1"><a href="#Start-Training-Process-1" class="headerlink" title="Start Training Process"></a>Start Training Process</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">bert <span class="token operator">=</span> BERTBaseUncased<span class="token punctuation">(</span>num_classes<span class="token operator">=</span>Config<span class="token punctuation">.</span>NUM_CLASSES<span class="token punctuation">)</span>
bert<span class="token punctuation">.</span>unfreeze_bert_encoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
trainer <span class="token operator">=</span> pl<span class="token punctuation">.</span>Trainer<span class="token punctuation">(</span>gpus<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> 
                     precision<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> 
                     fast_dev_run<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                     max_epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> 
                     num_sanity_val_steps<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> 
                     deterministic<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>bert<span class="token punctuation">,</span> train_dataloader<span class="token punctuation">,</span> valid_dataloader<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Performance-1"><a href="#Performance-1" class="headerlink" title="Performance"></a>Performance</h3><p>After training 20 epochs, we can get f1 score of 51.4047% and accuracy of 50.8423%.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">test_probs <span class="token operator">=</span> bert<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>test_dataloader<span class="token punctuation">)</span>
test_preds <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>test_probs<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
metrics<span class="token punctuation">.</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_preds<span class="token punctuation">,</span> average<span class="token operator">=</span><span class="token string">"weighted"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metrics<span class="token punctuation">.</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_preds<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Accuracy curve is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bert-acc.png" class="">

<p>Loss curve is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bert-loss.png" class="">

<p>Confusion matrix is as follow.</p>
<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bert-cm.png" class="">

<h3 id="Backtest-1"><a href="#Backtest-1" class="headerlink" title="Backtest"></a>Backtest</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">trends <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>test_probs<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
entries<span class="token punctuation">,</span> exits <span class="token operator">=</span> trend_to_signal<span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>trends<span class="token punctuation">)</span><span class="token punctuation">)</span>

price_test <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
mlbp_bert <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                             entries<span class="token punctuation">,</span> 
                                             exits<span class="token punctuation">,</span> 
                                             show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_bert<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/nlp3.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/nlp4.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                           2018-01-01 00:00:00
End                             2020-12-10 00:00:00
Duration                          653 days 00:00:00
Init. Cash                                   1000.0
Total Profit                              546.37027
Total Return [%]                          54.637027
Benchmark Return [%]                      31.469924
Position Coverage [%]                     53.598775
Max. Drawdown [%]                         48.250763
Avg. Drawdown [%]                         14.777709
Max. Drawdown Duration            345 days 00:00:00
Avg. Drawdown Duration             63 days 21:36:00
Num. Trades                                     154
Win Rate [%]                                   50.0
Best Trade [%]                            27.551075
Worst Trade [%]                          -16.969197
Avg. Trade [%]                             0.468629
Max. Trade Duration                12 days 00:00:00
Avg. Trade Duration       2 days 06:23:22.597402597
Expectancy                                 3.547859
SQN                                        0.711113
Gross Exposure                             0.535988
Sharpe Ratio                                0.69902
Sortino Ratio                              1.059683
Calmar Ratio                               0.571815<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Save-and-Load-Model"><a href="#Save-and-Load-Model" class="headerlink" title="Save and Load Model"></a>Save and Load Model</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">trainer<span class="token punctuation">.</span>save_checkpoint<span class="token punctuation">(</span><span class="token string">"bert.ckpt"</span><span class="token punctuation">)</span>
bert_reload <span class="token operator">=</span> BERTBaseUncased<span class="token punctuation">.</span>load_from_checkpoint<span class="token punctuation">(</span>
    <span class="token string">"bert.ckpt"</span><span class="token punctuation">,</span> 
    num_classes<span class="token operator">=</span>Config<span class="token punctuation">.</span>NUM_CLASSES
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="NLP-based-Indicators-and-Technical-Indicators"><a href="#NLP-based-Indicators-and-Technical-Indicators" class="headerlink" title="NLP based Indicators and Technical Indicators"></a>NLP based Indicators and Technical Indicators</h1><p>To make a profitable strategy, multiple criteria of entry-and-exit signals are often combined to filter out false positive decisions. In this work, NLP based indicators and technical indicators are combined into one single entry-and-exit signal array with true/false value using logical operators. There are two operators that combine multiple true or false values into a single true/false value.</p>
<ul>
<li><code>AND</code> operator: returns true only if both values are true.</li>
<li><code>OR</code> operator: returns true when one of the values is true.</li>
</ul>
<p>NLP based models are trained to predict whether the trend of the price is increasing or decreasing. Next, NLP based indicators are constructed by some trading rules as follow:</p>
<ul>
<li>If the forecast on <code>T-1</code> day is “down-trend” and the forecast on <code>T</code> day is “up-trend”, then “buy” the open price on <code>T+1</code> day.</li>
<li>If the forecast on <code>T-1</code> day is “up-trend” and the forecast on <code>T</code> day is “down-trend”, then “sell” the open price on <code>T+1</code> day.</li>
<li>If continue forecasting “up-trend”, then keep holding with the long-position.</li>
<li>If continue forecasting “down-trend”, then keep holding without any long-position.</li>
</ul>
<p>There are two basic types oftechnical indicators: Overlay Indicators and Oscillator Indicators.</p>
<p>In this project, only <code>AND</code> operator is used to set the condition to two criteria (NLP based indicators and technical indicators). For example, the entry signal is triggered when the RSI is above 50 and the NLP based indicator is producing a buy signal.</p>
<h2 id="Relative-Strength-Index-RSI"><a href="#Relative-Strength-Index-RSI" class="headerlink" title="Relative Strength Index (RSI)"></a>Relative Strength Index (RSI)</h2><p>The Stochastic RSI (StochRSI) is a technical analysis indicator that ranges from 0 to 1 (or 0 to 100 on some charting platforms). It is calculated by applying the Stochastic oscillator formula to a collection of relative strength indexes (RSI). Overbought is defined as a StochRSI value above 0.8, while oversold is defined as a reading below 0.2. On the zero to 100 scale, above 80 is overbought, and below 20 is oversold.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">price_test <span class="token operator">=</span> text_price_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
rsi <span class="token operator">=</span> talib<span class="token punctuation">.</span>RSI<span class="token punctuation">(</span>close<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
rsi<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_rsi <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>rsi<span class="token operator">>=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_rsi<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-RSI"><a href="#TextCNN-and-RSI" class="headerlink" title="TextCNN and RSI"></a>TextCNN and RSI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             1410.484857
Total Return [%]                          141.048486
Benchmark Return [%]                       31.469924
Position Coverage [%]                      30.015314
Max. Drawdown [%]                          65.917264
Avg. Drawdown [%]                           8.716855
Max. Drawdown Duration             272 days 00:00:00
Avg. Drawdown Duration    39 days 05:08:34.285714286
Num. Trades                                        8
Win Rate [%]                                    50.0
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             22.796415
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration                 24 days 12:00:00
Expectancy                                176.310607
SQN                                         0.575284
Gross Exposure                              0.300153
Sharpe Ratio                                1.160131
Sortino Ratio                               1.730172
Calmar Ratio                                0.963688<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-RSI"><a href="#BERT-and-RSI" class="headerlink" title="BERT and RSI"></a>BERT and RSI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                           2018-01-01 00:00:00
End                             2020-12-10 00:00:00
Duration                          653 days 00:00:00
Init. Cash                                   1000.0
Total Profit                            1372.905056
Total Return [%]                         137.290506
Benchmark Return [%]                      31.469924
Position Coverage [%]                     25.267994
Max. Drawdown [%]                         21.791524
Avg. Drawdown [%]                          6.460679
Max. Drawdown Duration            164 days 00:00:00
Avg. Drawdown Duration             32 days 01:20:00
Num. Trades                                      69
Win Rate [%]                              56.521739
Best Trade [%]                            27.551075
Worst Trade [%]                            -9.51275
Avg. Trade [%]                             1.430394
Max. Trade Duration                12 days 00:00:00
Avg. Trade Duration       2 days 09:02:36.521739130
Expectancy                                19.897175
SQN                                         1.63859
Gross Exposure                              0.25268
Sharpe Ratio                               1.309545
Sortino Ratio                              2.280386
Calmar Ratio                               2.849444<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Williams-R-WILLR"><a href="#Williams-R-WILLR" class="headerlink" title="Williams %R (WILLR)"></a>Williams %R (WILLR)</h2><p>The Williams %R, often known as the Williams Percent Range, is a sort of momentum indicator that monitors overbought and oversold conditions and travels between 0 and -100. The Williams %R can be used to determine market entrance and exit points. A reading of -20 indicates that the market is overbought. A value of -80 indicates that the market is oversold.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
willr <span class="token operator">=</span> talib<span class="token punctuation">.</span>WILLR<span class="token punctuation">(</span>high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
willr<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_willr <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                              entries<span class="token operator">=</span><span class="token punctuation">(</span>willr<span class="token operator">>=</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                              exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                              show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_willr<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-WILLR"><a href="#TextCNN-and-WILLR" class="headerlink" title="TextCNN and WILLR"></a>TextCNN and WILLR</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             1197.129932
Total Return [%]                          119.712993
Benchmark Return [%]                       31.469924
Position Coverage [%]                      36.600306
Max. Drawdown [%]                          65.917264
Avg. Drawdown [%]                          11.492131
Max. Drawdown Duration             272 days 00:00:00
Avg. Drawdown Duration    42 days 07:23:04.615384615
Num. Trades                                        9
Win Rate [%]                               44.444444
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                               19.2688
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration                 26 days 13:20:00
Expectancy                                133.014437
SQN                                         0.536334
Gross Exposure                              0.366003
Sharpe Ratio                                1.038628
Sortino Ratio                               1.546713
Calmar Ratio                                0.838452<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-WILLR"><a href="#BERT-and-WILLR" class="headerlink" title="BERT and WILLR"></a>BERT and WILLR</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             3817.273877
Total Return [%]                          381.727388
Benchmark Return [%]                       31.469924
Position Coverage [%]                      21.898928
Max. Drawdown [%]                          13.930189
Avg. Drawdown [%]                           4.238248
Max. Drawdown Duration             138 days 00:00:00
Avg. Drawdown Duration    21 days 10:54:32.727272727
Num. Trades                                       60
Win Rate [%]                                    70.0
Best Trade [%]                             27.551075
Worst Trade [%]                            -7.566861
Avg. Trade [%]                              2.823779
Max. Trade Duration                 12 days 00:00:00
Avg. Trade Duration                  2 days 09:12:00
Expectancy                                 63.621231
SQN                                         3.163193
Gross Exposure                              0.218989
Sharpe Ratio                                2.360838
Sortino Ratio                               4.953118
Calmar Ratio                               10.107593<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Aroon-Oscillator-AROONOSC"><a href="#Aroon-Oscillator-AROONOSC" class="headerlink" title="Aroon Oscillator (AROONOSC)"></a>Aroon Oscillator (AROONOSC)</h2><p>The Aroon indicator is a technical indicator that may be used to detect price trend changes as well as the strength of that trend. In essence, the indicator calculates the time between highs and lows over a given period of time. The notion is that strong uptrends will see new highs on a frequent basis, whereas strong downtrends would see new lows on a frequent basis.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
aroonosc <span class="token operator">=</span> talib<span class="token punctuation">.</span>AROONOSC<span class="token punctuation">(</span>high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
aroonosc<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_aroonosc <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                                 entries<span class="token operator">=</span><span class="token punctuation">(</span>aroonosc<span class="token operator">>=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                                 exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                                 show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_aroonosc<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-AROONOSC"><a href="#TextCNN-and-AROONOSC" class="headerlink" title="TextCNN and AROONOSC"></a>TextCNN and AROONOSC</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                        58.852402
Total Return [%]                      5.88524
Benchmark Return [%]                31.469924
Position Coverage [%]               16.385911
Max. Drawdown [%]                   60.573478
Avg. Drawdown [%]                   17.173099
Max. Drawdown Duration      494 days 00:00:00
Avg. Drawdown Duration      112 days 09:36:00
Num. Trades                                 8
Win Rate [%]                             62.5
Best Trade [%]                      44.929126
Worst Trade [%]                    -34.745424
Avg. Trade [%]                       2.854736
Max. Trade Duration          33 days 00:00:00
Avg. Trade Duration          13 days 09:00:00
Expectancy                            7.35655
SQN                                  0.104441
Gross Exposure                       0.163859
Sharpe Ratio                         0.301499
Sortino Ratio                        0.397515
Calmar Ratio                         0.053622<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-AROONOSC"><a href="#BERT-and-AROONOSC" class="headerlink" title="BERT and AROONOSC"></a>BERT and AROONOSC</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             1411.933816
Total Return [%]                          141.193382
Benchmark Return [%]                       31.469924
Position Coverage [%]                      22.205207
Max. Drawdown [%]                          23.302887
Avg. Drawdown [%]                           6.746358
Max. Drawdown Duration             164 days 00:00:00
Avg. Drawdown Duration    30 days 07:34:44.210526315
Num. Trades                                       70
Win Rate [%]                               57.142857
Best Trade [%]                             27.551075
Worst Trade [%]                             -9.51275
Avg. Trade [%]                              1.430573
Max. Trade Duration                 12 days 00:00:00
Avg. Trade Duration        2 days 01:22:17.142857142
Expectancy                                 20.170483
SQN                                          1.70467
Gross Exposure                              0.222052
Sharpe Ratio                                1.403516
Sortino Ratio                               2.525902
Calmar Ratio                                2.728357<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Balance-Of-Power-BOP"><a href="#Balance-Of-Power-BOP" class="headerlink" title="Balance Of Power (BOP)"></a>Balance Of Power (BOP)</h2><p>Balance of Power (BOP) is an oscillator that measures the strength of buying and selling pressure. Introduced by Igor Levshin in the August 2001 issue of Technical Analysis of Stocks &amp; Commodities magazine, this indicator compares the power of buyers to push prices to higher extremes with the power of sellers to move prices to lower extremes. When the indicator is in positive territory, the bulls are in charge; and sellers dominate when the indicator is negative. A reading near the zero line indicates a balance between the two and can mean a trend reversal.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">open_ <span class="token operator">=</span> price_test<span class="token punctuation">.</span><span class="token builtin">open</span>
high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
bop <span class="token operator">=</span> talib<span class="token punctuation">.</span>BOP<span class="token punctuation">(</span>open_<span class="token punctuation">,</span> high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">)</span>
bop<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_bop <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>bop<span class="token operator">>=</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_bop<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-BOP"><a href="#TextCNN-and-BOP" class="headerlink" title="TextCNN and BOP"></a>TextCNN and BOP</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                       -387.11781
Total Return [%]                   -38.711781
Benchmark Return [%]                31.469924
Position Coverage [%]                 9.49464
Max. Drawdown [%]                   58.149854
Avg. Drawdown [%]                   33.387792
Max. Drawdown Duration      469 days 00:00:00
Avg. Drawdown Duration      276 days 12:00:00
Num. Trades                                 4
Win Rate [%]                              0.0
Best Trade [%]                      -0.620421
Worst Trade [%]                    -34.745424
Avg. Trade [%]                     -10.232098
Max. Trade Duration          22 days 00:00:00
Avg. Trade Duration          15 days 12:00:00
Expectancy                         -96.779453
SQN                                 -1.261007
Gross Exposure                       0.094946
Sharpe Ratio                        -0.546112
Sortino Ratio                       -0.662911
Calmar Ratio                        -0.411706<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-BOP"><a href="#BERT-and-BOP" class="headerlink" title="BERT and BOP"></a>BERT and BOP</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                           2018-01-01 00:00:00
End                             2020-12-10 00:00:00
Duration                          653 days 00:00:00
Init. Cash                                   1000.0
Total Profit                             852.560933
Total Return [%]                          85.256093
Benchmark Return [%]                      31.469924
Position Coverage [%]                      3.675345
Max. Drawdown [%]                         13.856424
Avg. Drawdown [%]                          7.633348
Max. Drawdown Duration            139 days 00:00:00
Avg. Drawdown Duration             82 days 00:00:00
Num. Trades                                      11
Win Rate [%]                              90.909091
Best Trade [%]                            21.832492
Worst Trade [%]                           -7.165814
Avg. Trade [%]                             5.996617
Max. Trade Duration                 5 days 00:00:00
Avg. Trade Duration       2 days 04:21:49.090909090
Expectancy                                77.505539
SQN                                        3.051468
Gross Exposure                             0.036753
Sharpe Ratio                               1.699568
Sortino Ratio                              3.867465
Calmar Ratio                               2.969575<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Market-Meanness-Index-MMI"><a href="#Market-Meanness-Index-MMI" class="headerlink" title="Market Meanness Index (MMI)"></a>Market Meanness Index (MMI)</h2><p>The <a target="_blank" rel="noopener" href="https://financial-hacker.com/the-market-meanness-index/">Market Meanness Index</a> tells whether the market is currently moving in or out of a ‘trending’ regime. It can this way prevent losses by false signals of trend indicators. It is a purely statisticalalgorithm and not based on volatility, trends, or cycles of the price curve.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">mmi_days <span class="token operator">=</span> <span class="token number">20</span>
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
median <span class="token operator">=</span> close<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>mmi_days<span class="token punctuation">)</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span>
p1 <span class="token operator">=</span> close<span class="token operator">></span>median
p2 <span class="token operator">=</span> close<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> median
mmi <span class="token operator">=</span> <span class="token punctuation">(</span>p1 <span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>mmi_days<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
mmi<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_mmi <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>mmi<span class="token operator">>=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_mmi<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-MMI"><a href="#TextCNN-and-MMI" class="headerlink" title="TextCNN and MMI"></a>TextCNN and MMI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                              164.578985
Total Return [%]                           16.457898
Benchmark Return [%]                       31.469924
Position Coverage [%]                      28.024502
Max. Drawdown [%]                           57.57344
Avg. Drawdown [%]                          17.096136
Max. Drawdown Duration             294 days 00:00:00
Avg. Drawdown Duration    83 days 17:08:34.285714285
Num. Trades                                        7
Win Rate [%]                               14.285714
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             14.702369
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration       26 days 03:25:42.857142857
Expectancy                                 23.511284
SQN                                         0.115111
Gross Exposure                              0.280245
Sharpe Ratio                                0.445331
Sortino Ratio                               0.622654
Calmar Ratio                                0.154401<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-MMI"><a href="#BERT-and-MMI" class="headerlink" title="BERT and MMI"></a>BERT and MMI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                        -61.14569
Total Return [%]                    -6.114569
Benchmark Return [%]                31.469924
Position Coverage [%]               24.808576
Max. Drawdown [%]                   47.765242
Avg. Drawdown [%]                   13.595813
Max. Drawdown Duration      299 days 00:00:00
Avg. Drawdown Duration       74 days 12:00:00
Num. Trades                                69
Win Rate [%]                        42.028986
Best Trade [%]                      27.551075
Worst Trade [%]                    -12.259609
Avg. Trade [%]                        0.08213
Max. Trade Duration          12 days 00:00:00
Avg. Trade Duration           2 days 08:00:00
Expectancy                          -0.886169
SQN                                 -0.113694
Gross Exposure                       0.248086
Sharpe Ratio                         0.125302
Sortino Ratio                        0.199014
Calmar Ratio                        -0.072548<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Commodity-Channel-Index-CCI"><a href="#Commodity-Channel-Index-CCI" class="headerlink" title="Commodity Channel Index (CCI)"></a>Commodity Channel Index (CCI)</h2><p>The Commodity Channel Index (CCI) is a momentum-based oscillator used to help determine when an investment vehicle is reaching a condition of being overbought or oversold. When the CCI is above zero, it indicates the price is above the historic average. Conversely, when the CCI is below zero, the price is below the historic average.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
cci <span class="token operator">=</span> talib<span class="token punctuation">.</span>CCI<span class="token punctuation">(</span>high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
cci<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_cci <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>cci<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_cci<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-CCI"><a href="#TextCNN-and-CCI" class="headerlink" title="TextCNN and CCI"></a>TextCNN and CCI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             1158.734851
Total Return [%]                          115.873485
Benchmark Return [%]                       31.469924
Position Coverage [%]                      37.212864
Max. Drawdown [%]                          65.917264
Avg. Drawdown [%]                          11.588112
Max. Drawdown Duration             272 days 00:00:00
Avg. Drawdown Duration    42 days 07:23:04.615384615
Num. Trades                                       10
Win Rate [%]                                    40.0
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             17.167169
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration                 24 days 07:12:00
Expectancy                                115.873485
SQN                                         0.530371
Gross Exposure                              0.372129
Sharpe Ratio                                1.022194
Sortino Ratio                               1.522095
Calmar Ratio                                0.815354<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-CCI"><a href="#BERT-and-CCI" class="headerlink" title="BERT and CCI"></a>BERT and CCI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                           2018-01-01 00:00:00
End                             2020-12-10 00:00:00
Duration                          653 days 00:00:00
Init. Cash                                   1000.0
Total Profit                            3357.754498
Total Return [%]                          335.77545
Benchmark Return [%]                      31.469924
Position Coverage [%]                     26.799387
Max. Drawdown [%]                         18.274166
Avg. Drawdown [%]                          4.626804
Max. Drawdown Duration            110 days 00:00:00
Avg. Drawdown Duration             21 days 21:07:12
Num. Trades                                      73
Win Rate [%]                              64.383562
Best Trade [%]                            27.551075
Worst Trade [%]                            -9.51275
Avg. Trade [%]                             2.201906
Max. Trade Duration                12 days 00:00:00
Avg. Trade Duration       2 days 09:32:03.287671232
Expectancy                                45.996637
SQN                                        2.703271
Gross Exposure                             0.267994
Sharpe Ratio                               2.123362
Sortino Ratio                               4.15713
Calmar Ratio                               6.986814<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Moving-Average-Convergence-Divergence-MACD"><a href="#Moving-Average-Convergence-Divergence-MACD" class="headerlink" title="Moving Average Convergence/Divergence (MACD)"></a>Moving Average Convergence/Divergence (MACD)</h2><p>Moving average convergence divergence (MACD) is a trend-following momentum indicator that shows the relationship between two moving averages of a security’s price. The MACD is calculated by subtracting the 26-period exponential moving average (EMA) from the 12-period EMA.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
macd<span class="token punctuation">,</span> macdsignal<span class="token punctuation">,</span> macdhist <span class="token operator">=</span> talib<span class="token punctuation">.</span>MACD<span class="token punctuation">(</span>close<span class="token punctuation">,</span> fastperiod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> slowperiod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">,</span> signalperiod<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">)</span>
macd<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_macd <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                             entries<span class="token operator">=</span><span class="token punctuation">(</span>macd<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                             exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                             show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_macd<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-MACD"><a href="#TextCNN-and-MACD" class="headerlink" title="TextCNN and MACD"></a>TextCNN and MACD</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                       990.617772
Total Return [%]                    99.061777
Benchmark Return [%]                31.469924
Position Coverage [%]               31.087289
Max. Drawdown [%]                   64.725467
Avg. Drawdown [%]                   10.406998
Max. Drawdown Duration      272 days 00:00:00
Avg. Drawdown Duration       44 days 22:00:00
Num. Trades                                 9
Win Rate [%]                        55.555556
Best Trade [%]                     177.321644
Worst Trade [%]                    -34.745424
Avg. Trade [%]                      18.092523
Max. Trade Duration          99 days 00:00:00
Avg. Trade Duration          22 days 13:20:00
Expectancy                         110.068641
SQN                                  0.501126
Gross Exposure                       0.310873
Sharpe Ratio                         0.969612
Sortino Ratio                        1.428536
Calmar Ratio                         0.725122<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-MACD"><a href="#BERT-and-MACD" class="headerlink" title="BERT and MACD"></a>BERT and MACD</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                       501.301519
Total Return [%]                    50.130152
Benchmark Return [%]                31.469924
Position Coverage [%]               21.133231
Max. Drawdown [%]                   35.199714
Avg. Drawdown [%]                    8.540103
Max. Drawdown Duration      266 days 00:00:00
Avg. Drawdown Duration       44 days 18:00:00
Num. Trades                                64
Win Rate [%]                             50.0
Best Trade [%]                      27.551075
Worst Trade [%]                      -9.51275
Avg. Trade [%]                       0.792115
Max. Trade Duration          12 days 00:00:00
Avg. Trade Duration           2 days 03:22:30
Expectancy                           7.832836
SQN                                  0.779408
Gross Exposure                       0.211332
Sharpe Ratio                         0.756469
Sortino Ratio                        1.262302
Calmar Ratio                         0.724393<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Money-Flow-Index-MFI"><a href="#Money-Flow-Index-MFI" class="headerlink" title="Money Flow Index (MFI)"></a>Money Flow Index (MFI)</h2><p>The Money Flow Index (MFI) is a technical oscillator that uses price and volume data for identifying overbought or oversold signals in an asset. It can also be used to spot divergences which warn of a trend change in price. The oscillator moves between 0 and 100. Unlike conventional oscillators such as the Relative Strength Index (RSI), the Money Flow Index incorporates both price and volume data, as opposed to just price. For this reason, some analysts call MFI the volume-weighted RSI.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
volume <span class="token operator">=</span> price_test<span class="token punctuation">.</span>volume
mfi <span class="token operator">=</span> talib<span class="token punctuation">.</span>MFI<span class="token punctuation">(</span>high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> volume<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
mfi<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_mfi <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>mfi<span class="token operator">>=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_mfi<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-MFI"><a href="#TextCNN-and-MFI" class="headerlink" title="TextCNN and MFI"></a>TextCNN and MFI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                              543.096364
Total Return [%]                           54.309636
Benchmark Return [%]                       31.469924
Position Coverage [%]                      39.356815
Max. Drawdown [%]                          65.619075
Avg. Drawdown [%]                          15.958521
Max. Drawdown Duration             272 days 00:00:00
Avg. Drawdown Duration              55 days 04:48:00
Num. Trades                                       13
Win Rate [%]                               46.153846
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             11.136054
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration       19 days 18:27:41.538461538
Expectancy                                 41.776643
SQN                                         0.338795
Gross Exposure                              0.393568
Sharpe Ratio                                0.710413
Sortino Ratio                               1.016296
Calmar Ratio                                0.418163<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-MFI"><a href="#BERT-and-MFI" class="headerlink" title="BERT and MFI"></a>BERT and MFI</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                              755.505657
Total Return [%]                           75.550566
Benchmark Return [%]                       31.469924
Position Coverage [%]                      28.024502
Max. Drawdown [%]                          21.682457
Avg. Drawdown [%]                           8.642257
Max. Drawdown Duration             164 days 00:00:00
Avg. Drawdown Duration    43 days 06:51:25.714285714
Num. Trades                                       81
Win Rate [%]                                53.08642
Best Trade [%]                             27.551075
Worst Trade [%]                             -9.51275
Avg. Trade [%]                               0.84668
Max. Trade Duration                 12 days 00:00:00
Avg. Trade Duration        2 days 06:13:19.999999999
Expectancy                                   9.32723
SQN                                         1.140512
Gross Exposure                              0.280245
Sharpe Ratio                                0.943201
Sortino Ratio                               1.598255
Calmar Ratio                                1.704851<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Momentum-MOM"><a href="#Momentum-MOM" class="headerlink" title="Momentum (MOM)"></a>Momentum (MOM)</h2><p>The Momentum Indicator (MOM) is a leading indicator measuring a security’s rate-of-change. It compares the current price with the previous price from a number of periods ago.The ongoing plot forms an oscillator that moves above and below 0. It is a fully unbounded oscillator and has no lower or upper limit. Bullish and bearish interpretations are found by looking for divergences, centerline crossovers and extreme readings. The indicator is often used in combination with other signals.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
mom <span class="token operator">=</span> talib<span class="token punctuation">.</span>MOM<span class="token punctuation">(</span>close<span class="token punctuation">,</span> timeperiod<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
mom<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_mom <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                            entries<span class="token operator">=</span><span class="token punctuation">(</span>mom<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                            exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                            show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_mom<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-MOM"><a href="#TextCNN-and-MOM" class="headerlink" title="TextCNN and MOM"></a>TextCNN and MOM</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                              889.771213
Total Return [%]                           88.977121
Benchmark Return [%]                       31.469924
Position Coverage [%]                      42.113323
Max. Drawdown [%]                          65.563822
Avg. Drawdown [%]                           12.87516
Max. Drawdown Duration             272 days 00:00:00
Avg. Drawdown Duration              55 days 04:48:00
Num. Trades                                       13
Win Rate [%]                               38.461538
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             12.246031
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration       21 days 03:41:32.307692307
Expectancy                                 68.443939
SQN                                         0.469819
Gross Exposure                              0.421133
Sharpe Ratio                                0.891946
Sortino Ratio                               1.312906
Calmar Ratio                                0.651662<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-MOM"><a href="#BERT-and-MOM" class="headerlink" title="BERT and MOM"></a>BERT and MOM</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                     2018-01-01 00:00:00
End                       2020-12-10 00:00:00
Duration                    653 days 00:00:00
Init. Cash                             1000.0
Total Profit                       1759.54364
Total Return [%]                   175.954364
Benchmark Return [%]                31.469924
Position Coverage [%]               28.177642
Max. Drawdown [%]                   20.780414
Avg. Drawdown [%]                    7.379898
Max. Drawdown Duration      116 days 00:00:00
Avg. Drawdown Duration       29 days 12:00:00
Num. Trades                                75
Win Rate [%]                        57.333333
Best Trade [%]                      27.551075
Worst Trade [%]                    -12.763619
Avg. Trade [%]                       1.539368
Max. Trade Duration          12 days 00:00:00
Avg. Trade Duration           2 days 10:33:36
Expectancy                          23.460582
SQN                                  2.002748
Gross Exposure                       0.281776
Sharpe Ratio                         1.466978
Sortino Ratio                         2.55946
Calmar Ratio                         3.674804<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Ultimate-Oscillator-ULTOSC"><a href="#Ultimate-Oscillator-ULTOSC" class="headerlink" title="Ultimate Oscillator (ULTOSC)"></a>Ultimate Oscillator (ULTOSC)</h2><p>The Ultimate Oscillator is a technical indicator that was developed by Larry Williams in 1976 to measure the price momentum of an asset across multiple timeframes. By using the weighted average of three different timeframes the indicator has less volatility and fewer trade signals compared to other oscillators that rely on a single timeframe. Buy and sell signals are generated following divergences. The Ultimately Oscillator generates fewer divergence signals than other oscillators due to its multi-timeframe construction. Buy signals occur when there is bullish divergence, the divergence low is below 30 on the indicator, and the oscillator then rises above the divergence high. A sell signal occurs when there is bearish divergence, the divergence high is above 70, and the oscillator then falls below the divergence low.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">high <span class="token operator">=</span> price_test<span class="token punctuation">.</span>high
low <span class="token operator">=</span> price_test<span class="token punctuation">.</span>low
close <span class="token operator">=</span> price_test<span class="token punctuation">.</span>close
ultosc <span class="token operator">=</span> talib<span class="token punctuation">.</span>ULTOSC<span class="token punctuation">(</span>high<span class="token punctuation">,</span> low<span class="token punctuation">,</span> close<span class="token punctuation">,</span> timeperiod1<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> timeperiod2<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> timeperiod3<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">)</span>
ultosc<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc1.png" class="">

<pre class="line-numbers language-python" data-language="python"><code class="language-python">mlbp_ultosc <span class="token operator">=</span> MachineLearningBacktestPortfolio<span class="token punctuation">(</span>price_test<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">,</span> 
                                               entries<span class="token operator">=</span><span class="token punctuation">(</span>ultosc<span class="token operator">>=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token operator">&amp;</span>entries<span class="token punctuation">,</span> 
                                               exits<span class="token operator">=</span>exits<span class="token punctuation">,</span> 
                                               show<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
mlbp_ultosc<span class="token punctuation">.</span>plot_risk<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TextCNN-and-ULTOSC"><a href="#TextCNN-and-ULTOSC" class="headerlink" title="TextCNN and ULTOSC"></a>TextCNN and ULTOSC</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc2.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc3.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             2438.525894
Total Return [%]                          243.852589
Benchmark Return [%]                       31.469924
Position Coverage [%]                      58.499234
Max. Drawdown [%]                          69.323364
Avg. Drawdown [%]                          10.761178
Max. Drawdown Duration             255 days 00:00:00
Avg. Drawdown Duration              34 days 06:00:00
Num. Trades                                       14
Win Rate [%]                                    50.0
Best Trade [%]                            177.321644
Worst Trade [%]                           -34.745424
Avg. Trade [%]                             17.228297
Max. Trade Duration                 99 days 00:00:00
Avg. Trade Duration       27 days 06:51:25.714285714
Expectancy                                174.180421
SQN                                         0.959201
Gross Exposure                              0.584992
Sharpe Ratio                                1.341326
Sortino Ratio                               2.085091
Calmar Ratio                                1.434422<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="BERT-and-ULTOSC"><a href="#BERT-and-ULTOSC" class="headerlink" title="BERT and ULTOSC"></a>BERT and ULTOSC</h3><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc4.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc5.png" class="">

<pre class="line-numbers language-none"><code class="language-none">Start                            2018-01-01 00:00:00
End                              2020-12-10 00:00:00
Duration                           653 days 00:00:00
Init. Cash                                    1000.0
Total Profit                             1885.787803
Total Return [%]                           188.57878
Benchmark Return [%]                       31.469924
Position Coverage [%]                      28.177642
Max. Drawdown [%]                          17.968363
Avg. Drawdown [%]                           6.135872
Max. Drawdown Duration             145 days 00:00:00
Avg. Drawdown Duration    26 days 21:42:51.428571428
Num. Trades                                       77
Win Rate [%]                               57.142857
Best Trade [%]                             27.551075
Worst Trade [%]                             -9.51275
Avg. Trade [%]                              1.541911
Max. Trade Duration                 12 days 00:00:00
Avg. Trade Duration        2 days 09:02:20.259740259
Expectancy                                 24.490751
SQN                                          2.06409
Gross Exposure                              0.281776
Sharpe Ratio                                1.544248
Sortino Ratio                               2.746532
Calmar Ratio                                4.498422<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="Performance-2"><a href="#Performance-2" class="headerlink" title="Performance"></a>Performance</h1><p>The total return is -27.1728% if only the TextCNN model is used to produce buy-and-sell signals. After using various technical indicators to filter out false negative signals, all average drawdowns are smaller than when using TextCNN alone. </p>
<p>Ten different technical indicators are deployed as filters in this project. Only BOP produces a worse Sharpe Ratio when utilising technical indicators as filters than when using TextCNN alone; on the other hand, the other 9 technical indicators produce a higher Sharpe Ratio score. However, the maximum drawdown is higher when utilising technical indicators as filters than when using TextCNN alone for all technical indicators.</p>
<table>
<thead>
<tr>
<th align="center">Technical Indicator</th>
<th align="center">Total Return [%]</th>
<th align="center">Max. Drawdown [%]</th>
<th align="center">Avg. Drawdown [%]</th>
<th align="center">Sharpe Ratio</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TextCNN</td>
<td align="center">-27.1728</td>
<td align="center">52.8665</td>
<td align="center">26.4332</td>
<td align="center">-0.4187</td>
</tr>
<tr>
<td align="center">TextCNN + RSI</td>
<td align="center">141.0484</td>
<td align="center">65.9172</td>
<td align="center">8.7168</td>
<td align="center">1.1601</td>
</tr>
<tr>
<td align="center">TextCNN + WILLR</td>
<td align="center">119.7129</td>
<td align="center">65.9172</td>
<td align="center">11.4921</td>
<td align="center">1.0386</td>
</tr>
<tr>
<td align="center">TextCNN + AROONOSC</td>
<td align="center">5.8852</td>
<td align="center">60.5734</td>
<td align="center">17.1731</td>
<td align="center">0.3014</td>
</tr>
<tr>
<td align="center">TextCNN + BOP</td>
<td align="center">-38.7117</td>
<td align="center">58.1498</td>
<td align="center">33.3877</td>
<td align="center">-0.5461</td>
</tr>
<tr>
<td align="center">TextCNN + MMI</td>
<td align="center">16.4578</td>
<td align="center">57.5734</td>
<td align="center">17.0961</td>
<td align="center">0.4453</td>
</tr>
<tr>
<td align="center">TextCNN + CCI</td>
<td align="center">115.8734</td>
<td align="center">65.9172</td>
<td align="center">11.5881</td>
<td align="center">1.0221</td>
</tr>
<tr>
<td align="center">TextCNN + MACD</td>
<td align="center">99.0617</td>
<td align="center">64.7254</td>
<td align="center">10.4069</td>
<td align="center">0.9696</td>
</tr>
<tr>
<td align="center">TextCNN + MFI</td>
<td align="center">54.3096</td>
<td align="center">65.6190</td>
<td align="center">15.9585</td>
<td align="center">0.7104</td>
</tr>
<tr>
<td align="center">TextCNN + MOM</td>
<td align="center">88.9771</td>
<td align="center">65.5638</td>
<td align="center">12.8751</td>
<td align="center">0.8919</td>
</tr>
<tr>
<td align="center">TextCNN + ULTOSC</td>
<td align="center">243.8525</td>
<td align="center">69.3233</td>
<td align="center">10.7611</td>
<td align="center">1.3413</td>
</tr>
</tbody></table>
<p>BERT appears to produce a better outcome than TextCNN. Except for MMI, all of the indicators that integrate with BERT can have a total return of more than 50%. Despite having a negative total return of -6.1145, BERT + MMI has a positive Sharpe Ratio of 0.1253. When combining BERT and technical indicators, the maximum and average drawdowns are smaller than when using the language model alone, and the Sharpe Ratio are all positive. WILLR and CCI can even triple the total return compared to the original.</p>
<table>
<thead>
<tr>
<th align="center">Technical Indicator</th>
<th align="center">Total Return [%]</th>
<th align="center">Max. Drawdown [%]</th>
<th align="center">Avg. Drawdown [%]</th>
<th align="center">Sharpe Ratio</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BERT</td>
<td align="center">54.6370</td>
<td align="center">48.2507</td>
<td align="center">14.7777</td>
<td align="center">0.6990</td>
</tr>
<tr>
<td align="center">BERT + RSI</td>
<td align="center">137.2905</td>
<td align="center">21.7915</td>
<td align="center">6.4606</td>
<td align="center">1.3095</td>
</tr>
<tr>
<td align="center">BERT + WILLR</td>
<td align="center">381.7274</td>
<td align="center">13.9302</td>
<td align="center">4.2382</td>
<td align="center">2.3608</td>
</tr>
<tr>
<td align="center">BERT + AROONOSC</td>
<td align="center">141.1933</td>
<td align="center">23.3028</td>
<td align="center">6.7464</td>
<td align="center">1.4035</td>
</tr>
<tr>
<td align="center">BERT + BOP</td>
<td align="center">85.2560</td>
<td align="center">13.8564</td>
<td align="center">7.6333</td>
<td align="center">1.6996</td>
</tr>
<tr>
<td align="center">BERT + MMI</td>
<td align="center">-6.1145</td>
<td align="center">47.7652</td>
<td align="center">13.5958</td>
<td align="center">0.1253</td>
</tr>
<tr>
<td align="center">BERT + CCI</td>
<td align="center">335.7754</td>
<td align="center">18.2741</td>
<td align="center">4.6268</td>
<td align="center">2.1233</td>
</tr>
<tr>
<td align="center">BERT + MACD</td>
<td align="center">50.1301</td>
<td align="center">35.1997</td>
<td align="center">8.5401</td>
<td align="center">0.7564</td>
</tr>
<tr>
<td align="center">BERT + MFI</td>
<td align="center">75.5505</td>
<td align="center">21.6824</td>
<td align="center">8.6422</td>
<td align="center">0.9432</td>
</tr>
<tr>
<td align="center">BERT + MOM</td>
<td align="center">175.9543</td>
<td align="center">20.7804</td>
<td align="center">7.3798</td>
<td align="center">1.4669</td>
</tr>
<tr>
<td align="center">BERT + ULTOSC</td>
<td align="center">188.5787</td>
<td align="center">17.9683</td>
<td align="center">6.1358</td>
<td align="center">1.5442</td>
</tr>
</tbody></table>
<h1 id="CSCV"><a href="#CSCV" class="headerlink" title="CSCV"></a>CSCV</h1><p>I use combinatorially symmetric cross validation (CSCV) in particular to implement Sharpe ratio-based strategy performance testing. The probability of backtest overfit, performance degradation, probability of loss, and stochastic dominance are computed and visualised. The Sharpe ratio was employed as a performance metric by the writers in the <a target="_blank" rel="noopener" href="https://www.davidhbailey.com/dhbpapers/backtest-prob.pdf">reference</a>. Other measurements are appropriate based on the assumptions made in the research.</p>
<h2 id="RSI"><a href="#RSI" class="headerlink" title="RSI"></a>RSI</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/rsi-pp.png" class="">

<h2 id="WILLR"><a href="#WILLR" class="headerlink" title="WILLR"></a>WILLR</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/willr-pp.png" class="">

<h2 id="AROONOSC"><a href="#AROONOSC" class="headerlink" title="AROONOSC"></a>AROONOSC</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/aroonosc-pp.png" class="">

<h2 id="BOP"><a href="#BOP" class="headerlink" title="BOP"></a>BOP</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/bop-pp.png" class="">

<h2 id="MMI"><a href="#MMI" class="headerlink" title="MMI"></a>MMI</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mmi-pp.png" class="">

<h2 id="CCI"><a href="#CCI" class="headerlink" title="CCI"></a>CCI</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/cci-pp.png" class="">

<h2 id="MACD"><a href="#MACD" class="headerlink" title="MACD"></a>MACD</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/macd-pp.png" class="">

<h2 id="MFI"><a href="#MFI" class="headerlink" title="MFI"></a>MFI</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mfi-pp.png" class="">

<h2 id="MOM"><a href="#MOM" class="headerlink" title="MOM"></a>MOM</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/mom-pp.png" class="">

<h2 id="ULTOSC"><a href="#ULTOSC" class="headerlink" title="ULTOSC"></a>ULTOSC</h2><img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc-cscv.png" class="">

<img src="/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/ultosc-pp.png" class="">

<h1 id="PBO-Results"><a href="#PBO-Results" class="headerlink" title="PBO Results"></a>PBO Results</h1><p>PoL indicates Probability of Loss and PBO indicates Probability of Backtest Overfitting. Slope is for the measurement of Performance Degradation.</p>
<table>
<thead>
<tr>
<th align="center">Technical Indicator</th>
<th align="center">PBO [%]</th>
<th align="center">PBO (without LM) [%]</th>
<th align="center">PoL [%]</th>
<th align="center">PoL (without LM) [%]</th>
<th align="center">Slope</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BERT + RSI</td>
<td align="center">12.70</td>
<td align="center">17.86</td>
<td align="center">3.66</td>
<td align="center">0.00</td>
<td align="center">-0.52</td>
</tr>
<tr>
<td align="center">BERT + WILLR</td>
<td align="center">6.75</td>
<td align="center">26.98</td>
<td align="center">1.98</td>
<td align="center">17.34</td>
<td align="center">-1.71</td>
</tr>
<tr>
<td align="center">BERT + AROONOSC</td>
<td align="center">13.10</td>
<td align="center">45.63</td>
<td align="center">1.98</td>
<td align="center">2.38</td>
<td align="center">-1.15</td>
</tr>
<tr>
<td align="center">BERT + BOP</td>
<td align="center">54.76</td>
<td align="center">-</td>
<td align="center">0.00</td>
<td align="center">-</td>
<td align="center">-0.83</td>
</tr>
<tr>
<td align="center">BERT + MMI</td>
<td align="center">22.22</td>
<td align="center">23.02</td>
<td align="center">12.05</td>
<td align="center">0.40</td>
<td align="center">-0.76</td>
</tr>
<tr>
<td align="center">BERT + CCI</td>
<td align="center">3.57</td>
<td align="center">48.02</td>
<td align="center">3.57</td>
<td align="center">8.73</td>
<td align="center">-1.48</td>
</tr>
<tr>
<td align="center">BERT + MACD</td>
<td align="center">11.51</td>
<td align="center">-</td>
<td align="center">8.10</td>
<td align="center">-</td>
<td align="center">-0.27</td>
</tr>
<tr>
<td align="center">BERT + MFI</td>
<td align="center">7.54</td>
<td align="center">46.03</td>
<td align="center">5.56</td>
<td align="center">6.35</td>
<td align="center">-1.41</td>
</tr>
<tr>
<td align="center">BERT + MOM</td>
<td align="center">22.62</td>
<td align="center">29.76</td>
<td align="center">1.59</td>
<td align="center">5.95</td>
<td align="center">-1.38</td>
</tr>
<tr>
<td align="center">BERT + ULTOSC</td>
<td align="center">14.29</td>
<td align="center">-</td>
<td align="center">0.79</td>
<td align="center">-</td>
<td align="center">-1.47</td>
</tr>
</tbody></table>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>When employing numerous criteria to make trading decisions, especially when combining NLP-based indicators with technical indicators, the profit and sharpe ratio can be greatly increased, and drawdown can be significantly decreased.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/mrbcuda/pbo">https://github.com/mrbcuda/pbo</a></li>
<li><a target="_blank" rel="noopener" href="https://www.davidhbailey.com/dhbpapers/backtest-prob.pdf">https://www.davidhbailey.com/dhbpapers/backtest-prob.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://sites.math.washington.edu/~morrow/336_17/papers17/akshay.pdf">https://sites.math.washington.edu/~morrow/336_17/papers17/akshay.pdf</a></li>
</ol>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/Yang-Tech-Blog/about" rel="external nofollow noreferrer">Yang Wang</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://penguinwang96825.github.io/Yang-Tech-Blog/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/">https://penguinwang96825.github.io/Yang-Tech-Blog/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/Yang-Tech-Blog/about" target="_blank">Yang Wang</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/Yang-Tech-Blog/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                                <a href="/Yang-Tech-Blog/tags/NLP/">
                                    <span class="chip bg-color">NLP</span>
                                </a>
                            
                                <a href="/Yang-Tech-Blog/tags/Trading/">
                                    <span class="chip bg-color">Trading</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/Yang-Tech-Blog/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>WeChat swipe to share！</p>"></div>
    <script src="/Yang-Tech-Blog/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://penguinwang96825.github.io/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/';
        this.page.identifier = '/Yang-Tech-Blog/2021/06/10/2021-06-10-integrate-nlp-with-technical-indicators/';
        this.page.title = 'Integrate NLP with Technical Indicators';
    };
    let disqus_shortname = 'penguinwang';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/Yang-Tech-Blog/2021/08/28/2021-08-28-linear-regression-using-statsmodels/">
                    <div class="card-image">
                        
                        <img src="https://github.com/penguinwang96825/penguinwang96825.github.io/blob/master/2021/08/28/2021-08-28-linear-regression-using-statsmodels/wallhaven-8oky1j.jpg?raw=true" class="responsive-img" alt="Linear Regression using statsmodels">
                        
                        <span class="card-title">Linear Regression using statsmodels</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            A linear regression to modelling the relationship between a scalar response and one or more explanatory variables is known as linear regression in statistics (also known as dependent and independent variables). Simple linear regression is used when there is only one explanatory variable; multiple linear regression is used when there are more than one.
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-08-28
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/Yang-Tech-Blog/categories/Statistics/" class="post-category">
                                    Statistics
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/Yang-Tech-Blog/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                    <a href="/Yang-Tech-Blog/tags/Statistics/">
                        <span class="chip bg-color">Statistics</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/Yang-Tech-Blog/2021/06/09/2021-06-09-simpson-rule-for-definite-integrals/">
                    <div class="card-image">
                        
                        <img src="https://github.com/penguinwang96825/penguinwang96825.github.io/blob/master/2021/06/09/2021-06-09-simpson-rule-for-definite-integrals/wallhaven-g7jg63.png?raw=true" class="responsive-img" alt="Simpson Rule for Definite Integrals">
                        
                        <span class="card-title">Simpson Rule for Definite Integrals</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Simpson's rules are numerous approximations for definite integrals in numerical analysis, named after English mathematician Thomas Simpson (1710−1761). In calculus, basically, there are two ways to approximate the value of an integral, Reimann sums and Trapezoidal sums. However, calculating the value of an integral, we need to compute the areas of a zillion rectangles or more to get a better result. Therefore, we use Simpson's Rule, which is a way to approximate integrals without having to deal with lots of narrow rectangles.
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-06-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/Yang-Tech-Blog/categories/Mathematics/" class="post-category">
                                    Mathematics
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/Yang-Tech-Blog/tags/Numerical-Analysis/">
                        <span class="chip bg-color">Numerical Analysis</span>
                    </a>
                    
                    <a href="/Yang-Tech-Blog/tags/Integrals/">
                        <span class="chip bg-color">Integrals</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Yang&#39;s Blog<br />'
            + 'Author: Yang Wang<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + 'The copyright of this article belongs to the author, please indicate the source of any form of reproduction.';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/Yang-Tech-Blog/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/Yang-Tech-Blog/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/Yang-Tech-Blog/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/Yang-Tech-Blog/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/Yang-Tech-Blog/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

    <!-- footer -->
    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/Yang-Tech-Blog/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.3'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/Yang-Tech-Blog/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2018-2021</span>
            
            <span id="year">2018</span>
            <a href="/Yang-Tech-Blog/about" target="_blank">Yang Wang</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total site word count:&nbsp;<span
                class="white-color">111.5k</span>&nbsp;words
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;Total number of visits:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;times
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;Total number of visitors:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;people
            </span>
            
            <br>
            
            <span id="sitetime">Loading runtime...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2018";
                    var startMonth = "12";
                    var startDate = "3";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "This site has been safely operated " + diffDays + " days " + diffHours +
                            " hours " + diffMinutes + " minutes " + diffSeconds + " seconds";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "This site has been safely operated " + diffYears + " years " + diffDays +
                            " days " + diffHours + " hours " + diffMinutes + " minutes " + diffSeconds + " seconds";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/penguinwang96825" class="tooltipped" target="_blank" data-tooltip="Visit my GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:penguinwang@smail.nchu.edu.tw" class="tooltipped" target="_blank" data-tooltip="Contact me by mail" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/Yang-Tech-Blog/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/Yang-Tech-Blog/libs/materialize/materialize.min.js"></script>
    <script src="/Yang-Tech-Blog/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/Yang-Tech-Blog/libs/aos/aos.js"></script>
    <script src="/Yang-Tech-Blog/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/Yang-Tech-Blog/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/Yang-Tech-Blog/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/Yang-Tech-Blog/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/Yang-Tech-Blog/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    
    <script type="text/javascript" src="/Yang-Tech-Blog/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/Yang-Tech-Blog/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

<script>
    pseudocode.renderElement(document.getElementById("pseudocode"));
</script>

</html>
